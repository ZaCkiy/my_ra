<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Laporan Room Attendant</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #121212;
            --card-color: #1e1e1e;
            --text-color: #e0e0e0;
            --accent-color: #bb86fc;
            --success-color: #03dac6;
            --green-besi: #2e7d32; /* Hijau Besi untuk status selesai */
            --danger-color: #cf6679;
            --input-bg: #2c2c2c;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg-color); color: var(--text-color); -webkit-tap-highlight-color: transparent; padding-bottom: 20px;}
        
        /* Utility */
        .hidden { display: none !important; }
        .container { padding: 20px; max-width: 600px; margin: 0 auto; }
        h1, h2, h3 { margin-bottom: 10px; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-family: 'Poppins'; margin-top: 10px; transition: 0.2s;}
        .btn-primary { background-color: var(--accent-color); color: #000; }
        .btn-success { background-color: var(--success-color); color: #000; }
        .btn-danger { background-color: var(--danger-color); color: #fff; }
        .icon { margin-right: 8px; }

        /* Login Page */
        #login-page { display: flex; flex-direction: column; justify-content: center; height: 100vh; text-align: center; }
        input[type="text"], textarea { width: 100%; padding: 12px; background: var(--input-bg); border: 1px solid #444; color: #fff; border-radius: 8px; margin-bottom: 10px; font-family: 'Poppins'; }

        /* Dashboard Header */
        .header-stats { display: flex; justify-content: space-between; background: var(--card-color); padding: 15px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .stat-box { text-align: center; font-size: 0.8rem; }
        .stat-box span { display: block; font-size: 1.2rem; font-weight: bold; color: var(--accent-color); }

        /* Room List */
        .room-card { background: var(--card-color); padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-left: 5px solid var(--accent-color); }
        .room-card.completed { border-left: 5px solid var(--green-besi); background: #1b2e1b; } /* Warna Hijau Besi Gelap */
        .room-number { font-size: 1.2rem; font-weight: bold; }
        .room-status { font-size: 0.9rem; padding: 4px 8px; background: #333; border-radius: 4px; }
        
        /* Modal / Overlay */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        .status-grid, .number-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; }
        .grid-btn { padding: 15px; background: var(--card-color); border: 1px solid #444; color: #fff; border-radius: 8px; font-weight: bold; }

        /* Detail Page */
        .detail-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .time-btn { background: #333; color: var(--accent-color); border: 1px solid var(--accent-color); margin-bottom: 15px; }
        .time-btn.active { background: var(--accent-color); color: #000; }
        
        .item-list { display: flex; flex-direction: column; gap: 8px; }
        .item-row { background: var(--card-color); padding: 12px; border-radius: 8px; display: flex; justify-content: space-between; cursor: pointer; }
        .item-qty { font-weight: bold; color: var(--success-color); }

        /* Summary */
        .summary-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.8rem; }
        .summary-table th, .summary-table td { border: 1px solid #444; padding: 8px; text-align: left; }
        .summary-table th { background: #333; }

        /* Print Style (PDF) */
        @media print {
            body { background: #fff; color: #000; }
            .no-print, .btn, .header-stats { display: none; }
            #summary-content { display: block !important; }
            .summary-table th, .summary-table td { border: 1px solid #000; color: #000; }
        }
    </style>
</head>
<body>

    <div id="login-page" class="container">
        <h1><i class="fa-solid fa-broom icon"></i>MyRA</h1>
        <p style="margin-bottom: 20px; color: #aaa;">Aplikasi Laporan Room Attendant</p>
        <input type="text" id="username" placeholder="Masukkan Nama / ID Anda">
        <button class="btn btn-primary" onclick="login()">Masuk Shift</button>
    </div>

    <div id="dashboard-page" class="container hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3>Halo, <span id="display-name">User</span></h3>
            <i class="fa-solid fa-right-from-bracket" onclick="logout()" style="font-size: 1.2rem; cursor: pointer;"></i>
        </div>

        <div class="header-stats">
            <div class="stat-box"><span id="total-credits">0</span><i class="fa-solid fa-coins"></i> Kredit</div>
            <div class="stat-box"><span id="total-progress">0</span><i class="fa-solid fa-spinner"></i> Progres</div>
            <div class="stat-box"><span id="total-done" style="color: var(--success-color);">0</span><i class="fa-solid fa-check-circle"></i> Selesai</div>
        </div>

        <div style="background: var(--card-color); padding: 15px; border-radius: 12px; margin-bottom: 20px;">
            <h4><i class="fa-solid fa-plus-circle icon"></i>Input Kamar Baru</h4>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <input type="number" id="new-room-number" placeholder="No. Kamar" style="margin:0; width: 60%;">
                <button class="btn btn-primary" style="margin:0; width: 40%;" onclick="openStatusModal('initial')">Pilih Status</button>
            </div>
        </div>

        <div id="room-list">
            </div>

        <button class="btn btn-danger" style="margin-top: 30px;" onclick="showSummary()">
            <i class="fa-solid fa-file-invoice icon"></i> End Shift & Summary
        </button>
    </div>

    <div id="detail-page" class="container hidden">
        <div class="detail-header">
            <button onclick="goBack()" style="background:none; border:none; color:white; font-size:1.2rem;"><i class="fa-solid fa-arrow-left"></i></button>
            <h2 id="detail-room-number">Room 101</h2>
            <span id="detail-status-1" class="room-status">VD</span>
        </div>

        <button id="btn-time-in" class="btn time-btn" onclick="setTime('in')">
            <i class="fa-regular fa-clock icon"></i> Time In <span id="display-time-in">--:--</span>
        </button>

        <h4 style="margin: 15px 0 10px 0;"><i class="fa-solid fa-list-check icon"></i>Amenities & Linen</h4>
        <div id="amenities-list" class="item-list">
            </div>

        <h4 style="margin: 20px 0 10px 0;"><i class="fa-solid fa-sticky-note icon"></i>Catatan</h4>
        <textarea id="room-note" rows="3" placeholder="Contoh: Lampu redup, kran bocor..."></textarea>

        <button id="btn-time-out" class="btn time-btn" onclick="setTime('out')">
            <i class="fa-solid fa-clock icon"></i> Time Out <span id="display-time-out">--:--</span>
        </button>

        <button class="btn btn-success" onclick="openStatusModal('final')">
            <i class="fa-solid fa-check icon"></i> Status Akhir (Selesai)
        </button>
    </div>

    <div id="summary-page" class="container hidden">
        <div class="no-print" style="display: flex; justify-content: space-between; margin-bottom: 20px;">
            <button onclick="goBackToDashboard()" style="background:none; border:none; color:white; font-size:1.2rem;"><i class="fa-solid fa-arrow-left"></i> Kembali</button>
            <button onclick="printReport()" style="background:none; border:none; color:var(--accent-color); font-size:1.2rem;"><i class="fa-solid fa-print"></i> PDF</button>
        </div>

        <div id="summary-content">
            <h2 style="text-align: center; border-bottom: 1px solid #ccc; padding-bottom: 10px;">Laporan Harian Room Attendant</h2>
            <p><strong>Nama:</strong> <span id="sum-name"></span></p>
            <p><strong>Tanggal:</strong> <span id="sum-date"></span></p>
            <br>
            <table class="summary-table">
                <thead>
                    <tr>
                        <th>Room</th>
                        <th>Waktu</th>
                        <th>Status (Awal > Akhir)</th>
                        <th>Barang Terpakai</th>
                    </tr>
                </thead>
                <tbody id="summary-body">
                    </tbody>
            </table>
            
            <div style="margin-top: 20px; text-align: right;">
                <p>Total Kredit: <strong id="sum-credit">0</strong></p>
                <p>Total Selesai: <strong id="sum-done">0</strong></p>
            </div>
        </div>
    </div>

    <div id="status-modal" class="modal hidden">
        <h3 style="color: white; margin-bottom: 20px;">Pilih Status</h3>
        <div id="status-options" class="status-grid">
            </div>
        <button class="btn btn-danger" style="margin-top: 20px;" onclick="closeModal()">Batal</button>
    </div>

    <div id="qty-modal" class="modal hidden">
        <h3 style="color: white; margin-bottom: 20px;">Pilih Jumlah</h3>
        <div class="number-grid">
            <button class="grid-btn" onclick="selectQty(1)">1</button>
            <button class="grid-btn" onclick="selectQty(2)">2</button>
            <button class="grid-btn" onclick="selectQty(3)">3</button>
            <button class="grid-btn" onclick="selectQty(4)">4</button>
            <button class="grid-btn" onclick="selectQty(5)">5</button>
            <button class="grid-btn" onclick="selectQty(6)">6</button>
            <button class="grid-btn" onclick="selectQty(7)">7</button>
            <button class="grid-btn" onclick="selectQty(8)">8</button>
            <button class="grid-btn" onclick="selectQty(9)">9</button>
            <button class="grid-btn" onclick="selectQty(10)">10</button>
            <button class="grid-btn" style="background: #555;" onclick="selectQty(0)">0</button>
        </div>
        <button class="btn btn-danger" style="margin-top: 20px;" onclick="closeModal()">Batal</button>
    </div>

    <script>
        // DATA
        const itemsList = [
            "Sheet Twin", "Sheet King", "Duve Twin", "Duve King", "Pillow Case",
            "Bath Towel", "Hand Towel", "Bath Mat", "Soap", "Shampoo", "Dental Kit",
            "Shower Cap", "Sanitary Bag", "Cotton Bud", "Comb", "Tissue Roll", "Slipper",
            "Laundry Bag", "Laundry List", "Memo Pad", "Pencil", "White Sugar", "Brown Sugar",
            "Creamer", "Coffee", "Tea", "Mineral Water", "Stirrer", "Glass Coaster"
        ];
        const initialStatuses = ["VD", "OD", "NS", "SO", "ED", "VCU", "OO"];
        const finalStatuses = ["VC", "OC", "SO", "DL", "NS", "SR", "VCU", "OO"];

        let currentUser = localStorage.getItem('myra_user') || "";
        let rooms = JSON.parse(localStorage.getItem('myra_rooms')) || [];
        let currentRoomId = null; // ID room yang sedang diedit
        let currentStatusType = ""; // 'initial' atau 'final'
        let currentItemIndex = -1; // Index item yang sedang diedit qty-nya

        // INIT
        window.onload = function() {
            if (currentUser) {
                showDashboard();
            }
        };

        // NAVIGATION & LOGIN
        function login() {
            const name = document.getElementById('username').value;
            if (name.trim() === "") return alert("Harap isi nama!");
            currentUser = name;
            localStorage.setItem('myra_user', currentUser);
            showDashboard();
        }

        function logout() {
            if(confirm("Yakin ingin logout? Data sesi ini akan tetap tersimpan.")) {
                currentUser = "";
                localStorage.removeItem('myra_user');
                document.getElementById('login-page').classList.remove('hidden');
                document.getElementById('dashboard-page').classList.add('hidden');
            }
        }

        function showDashboard() {
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('detail-page').classList.add('hidden');
            document.getElementById('summary-page').classList.add('hidden');
            document.getElementById('dashboard-page').classList.remove('hidden');
            document.getElementById('display-name').innerText = currentUser;
            renderRoomList();
            updateStats();
        }

        // ROOM LOGIC
        function openStatusModal(type) {
            currentStatusType = type;
            const modal = document.getElementById('status-modal');
            const grid = document.getElementById('status-options');
            grid.innerHTML = "";
            
            const list = type === 'initial' ? initialStatuses : finalStatuses;
            list.forEach(status => {
                grid.innerHTML += `<button class="grid-btn" onclick="selectStatus('${status}')">${status}</button>`;
            });
            modal.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('status-modal').classList.add('hidden');
            document.getElementById('qty-modal').classList.add('hidden');
        }

        function selectStatus(status) {
            closeModal();
            if (currentStatusType === 'initial') {
                addRoom(status);
            } else {
                finishRoom(status);
            }
        }

        function addRoom(status) {
            const num = document.getElementById('new-room-number').value;
            if (!num) return alert("Masukkan nomor kamar!");
            
            const newRoom = {
                id: Date.now(),
                number: num,
                status1: status,
                status2: "", // Not used explicitly in flow but available
                status3: "",
                timeIn: "",
                timeOut: "",
                items: new Array(itemsList.length).fill(0),
                note: "",
                isCompleted: false
            };
            
            rooms.push(newRoom);
            saveData();
            document.getElementById('new-room-number').value = "";
            renderRoomList();
            updateStats();
        }

        function saveData() {
            localStorage.setItem('myra_rooms', JSON.stringify(rooms));
        }

        function renderRoomList() {
            const list = document.getElementById('room-list');
            list.innerHTML = "";
            rooms.forEach((room, index) => {
                // Status display logic
                let displayStatus = room.status1;
                if (room.isCompleted) displayStatus = `${room.status1} ‚ûù ${room.status3}`;

                list.innerHTML += `
                    <div class="room-card ${room.isCompleted ? 'completed' : ''}" onclick="openRoomDetail(${index})">
                        <div>
                            <div class="room-number">Unit ${room.number}</div>
                            <div style="font-size: 0.8rem; color:#aaa; margin-top:5px;">${room.timeIn || "--:--"} - ${room.timeOut || "--:--"}</div>
                        </div>
                        <div class="room-status">${displayStatus}</div>
                    </div>
                `;
            });
        }

        function updateStats() {
            document.getElementById('total-credits').innerText = rooms.length;
            const done = rooms.filter(r => r.isCompleted).length;
            document.getElementById('total-done').innerText = done;
            document.getElementById('total-progress').innerText = rooms.length - done;
        }

        // DETAIL ROOM
        function openRoomDetail(index) {
            currentRoomId = index;
            const room = rooms[index];
            
            document.getElementById('dashboard-page').classList.add('hidden');
            document.getElementById('detail-page').classList.remove('hidden');
            
            document.getElementById('detail-room-number').innerText = "Room " + room.number;
            document.getElementById('detail-status-1').innerText = room.status1;
            document.getElementById('room-note').value = room.note;
            
            // Render Items
            const itemListContainer = document.getElementById('amenities-list');
            itemListContainer.innerHTML = "";
            itemsList.forEach((item, i) => {
                const qty = room.items[i];
                const activeClass = qty > 0 ? "border-left: 3px solid var(--success-color);" : "";
                itemListContainer.innerHTML += `
                    <div class="item-row" style="${activeClass}" onclick="openQtyModal(${i})">
                        <span>${item}</span>
                        <span class="item-qty">${qty > 0 ? qty : ''}</span>
                    </div>
                `;
            });

            // Update Time UI
            renderTimeUI(room);
            
            // Auto save note on change
            document.getElementById('room-note').oninput = function() {
                rooms[currentRoomId].note = this.value;
                saveData();
            };
        }

        function renderTimeUI(room) {
            const btnIn = document.getElementById('btn-time-in');
            const btnOut = document.getElementById('btn-time-out');
            
            document.getElementById('display-time-in').innerText = room.timeIn || "--:--";
            document.getElementById('display-time-out').innerText = room.timeOut || "--:--";
            
            if(room.timeIn) btnIn.classList.add('active'); else btnIn.classList.remove('active');
            if(room.timeOut) btnOut.classList.add('active'); else btnOut.classList.remove('active');
        }

        function goBack() {
            document.getElementById('detail-page').classList.add('hidden');
            showDashboard();
        }

        function setTime(type) {
            const now = new Date();
            const timeString = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
            
            if (type === 'in') rooms[currentRoomId].timeIn = timeString;
            else rooms[currentRoomId].timeOut = timeString;
            
            saveData();
            renderTimeUI(rooms[currentRoomId]);
        }

        // ITEM QTY LOGIC
        function openQtyModal(itemIndex) {
            currentItemIndex = itemIndex;
            document.getElementById('qty-modal').classList.remove('hidden');
        }

        function selectQty(qty) {
            rooms[currentRoomId].items[currentItemIndex] = qty;
            saveData();
            closeModal();
            openRoomDetail(currentRoomId); // Re-render to show new qty
        }

        // FINISH ROOM
        function finishRoom(finalStatus) {
            rooms[currentRoomId].status3 = finalStatus;
            rooms[currentRoomId].isCompleted = true;
            saveData();
            goBack(); // Back to dashboard
        }

        // SUMMARY
        function showSummary() {
            document.getElementById('dashboard-page').classList.add('hidden');
            document.getElementById('summary-page').classList.remove('hidden');
            
            document.getElementById('sum-name').innerText = currentUser;
            const now = new Date();
            document.getElementById('sum-date').innerText = now.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            
            const tbody = document.getElementById('summary-body');
            tbody.innerHTML = "";
            
            rooms.forEach(room => {
                // Filter items that have qty > 0
                let itemsUsed = [];
                room.items.forEach((qty, i) => {
                    if(qty > 0) itemsUsed.push(`${itemsList[i]} (${qty})`);
                });
                
                tbody.innerHTML += `
                    <tr>
                        <td><strong>${room.number}</strong></td>
                        <td>${room.timeIn}<br>${room.timeOut}</td>
                        <td>${room.status1} <i class="fa-solid fa-arrow-right"></i> ${room.status3 || '-'}</td>
                        <td>${itemsUsed.join(', ') || '-'}</td>
                    </tr>
                `;
            });

            document.getElementById('sum-credit').innerText = rooms.length;
            document.getElementById('sum-done').innerText = rooms.filter(r => r.isCompleted).length;
        }

        function goBackToDashboard() {
            document.getElementById('summary-page').classList.add('hidden');
            document.getElementById('dashboard-page').classList.remove('hidden');
        }

        function printReport() {
            window.print();
        }
    </script>
</body>
</html>
